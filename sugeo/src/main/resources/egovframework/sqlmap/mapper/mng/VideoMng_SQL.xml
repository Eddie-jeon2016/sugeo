<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="VideoMngDAO">

	<!--비디오 리스트   -->
	<select id="VideoMngDAO.selectVideoMngList" resultType="VideoMngVO">
		SELECT
			VIDEO_ID
			, TITLE
			, URL
			, REG_DATE
			, REG_ID
			, MOD_DATE
			, MOD_ID
			, NOTICE_YN
			, USE_YN
		FROM
			VIDEO_MNG
		WHERE
			USE_YN = 'Y'
		<if test="searchKeyword != ''">AND
			TITLE LIKE CONCAT('%', #{searchKeyword},'%')
		</if>
		ORDER BY VIDEO_ID DESC
		LIMIT #{recordCountPerPage} OFFSET #{firstIndex}
			
	</select>
	
	<!--비디오 리스트 갯수 조회  -->
	<select id="VideoMngDAO.selectVideoMngListCnt" resultType="java.lang.Integer">
		SELECT
			COUNT(VIDEO_ID)
		FROM
			VIDEO_MNG
		WHERE
			USE_YN = 'Y'
		<if test="searchKeyword != ''">AND
			TITLE LIKE CONCAT('%', #{searchKeyword},'%')
		</if>
		<if test="searchCondition == 'noticeY'">AND
			NOTICE_YN = 'Y'
		</if>	
	</select>
	
	<!--비디오등록  -->
	<insert id="VideoMngDAO.insertVideoMng" parameterType="VideoMngVO">
		INSERT
		INTO VIDEO_MNG
			( VIDEO_ID
			, TITLE
			, URL
			, REG_DATE
			, REG_ID
			, NOTICE_YN
			, USE_YN
			)
		VALUES
			( #{videoId}
			, #{title}
			, #{url}
			, now()
			, #{regId}
			, #{noticeYn}
			, 'Y'
			)
	</insert>

	<!--비디오수정을 위한 리스트 조회  -->
	<select id="VideoMngDAO.selectVideoMngOneList" resultType="VideoMngVO" parameterType="hashmap">
		SELECT
			VIDEO_ID
			, TITLE
			, URL
			, REG_DATE
			, REG_ID
			, MOD_DATE
			, MOD_ID
			, NOTICE_YN
			, USE_YN
		FROM
			VIDEO_MNG
		WHERE
		<if test="searchCondition == 'videoId'">
			VIDEO_ID = #{videoId}
		</if>
		<if test="searchCondition == 'noticeY'">
			NOTICE_YN = 'Y'
			AND USE_YN = 'Y'
		</if>
		<if test="searchCondition == 'noticeN'">
			NOTICE_YN = 'N'
			AND USE_YN = 'Y'
		</if>
	</select>
	
	<!--비디오 수정 -->
	<update id="VideoMngDAO.updateVideoMng" parameterType="VideoMngVO">
		UPDATE VIDEO_MNG 
			SET TITLE = #{title}
				, URL = #{url}						
				, MOD_DATE = now()
				, MOD_ID = #{modId}
				, NOTICE_YN = #{noticeYn}
			WHERE VIDEO_ID = #{videoId}
	</update>
	
	<!--노출여부 수정  -->
	<update id="VideoMngDAO.updateVideoMngNoticeYn" parameterType="VideoMngVO">
		UPDATE VIDEO_MNG
			SET NOTICE_YN = #{noticeYn}
		WHERE VIDEO_ID = #{videoId}	
	</update>
	
	<!--노출여부 Y였던 게시물을 찾아서 N으로 바꾸기  -->
	<update id="VideoMngDAO.updateVideoMngNoticeYnintoN">
		UPDATE VIDEO_MNG
			SET NOTICE_YN = 'N'
		WHERE VIDEO_ID IN (SELECT *
							FROM(SELECT VIDEO_ID
							FROM VIDEO_MNG
							WHERE NOTICE_YN = 'Y' 
									AND USE_YN = 'Y')AS A)
	</update>
	
	
	<!--가장 최근 게시물 노출여부 수정  -->
	<update id="VideoMngDAO.updateVideoMngNoticeYnLately">
		UPDATE VIDEO_MNG 
			SET NOTICE_YN = 'Y'
		WHERE VIDEO_ID IN (SELECT *
							FROM (SELECT MAX(VIDEO_ID)
								  FROM VIDEO_MNG
								  WHERE USE_YN ='Y')AS A)
	</update>
	
	<!--비디오 글 삭제  -->
	<update id="VideoMngDAO.deleteVideoMng" parameterType="string">
		 UPDATE VIDEO_MNG
		 	SET USE_YN = 'N'
		 	WHERE VIDEO_ID = #{video_id}
	</update>
	
	
</mapper>
