<?xml version="1.0" encoding="UTF-8"?><!--Converted at: Wed Feb 01 15:11:03 KST 2017-->
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="CodeManageDAO">
	
	<resultMap id="codeListMap" type="CodeManageVO">
		<id column="CODE" property="code" />
		<result column="CODE_NAME" property="codeName" />
		<result column="USE_YN" property="useYn" />
		<result column="REG_DATE" property="regDate" />
		<result column="REG_ID" property="regId" />
		<result column="MOD_DATE" property="modDate" />
		<result column="MOD_ID" property="modId" />
		<result column="CODE_DESC" property="codeDesc"/>
		<collection property="subCodes" ofType="SubCodeManageVO" javaType="list">
			<id column="SUB_CODE" property="subCode" />
			<result column="SORT_NUM" property="sortNum" />
			<result column="SUB_CODE_DESC" property="subcodeDesc"/>
			<result column="SUB_CODE_NAME" property="subCodeName"/>
			<result column="OPTION_KEY" property="optionKey"/>
			<result column="USE_YN" property="useYn"/>
			<result column="REG_DATE" property="regDate"/>
			<result column="REG_ID" property="regId"/>
			<result column="MOD_DATE" property="modDate"/>
			<result column="MOD_ID" property="modId" />
		</collection>
	
	</resultMap>
	
	<select id="CodeManageDAO.selectAllCodeList" parameterType="string" resultMap="codeListMap">
		SELECT A.CODE
			, A.CODE_NAME
			, A.USE_YN
			, A.REG_DATE
			, A.REG_ID
			, A.MOD_DATE
			, A.MOD_ID
			, A.CODE_DESC
            , B.CODE
			, B.SUB_CODE
			, B.SORT_NUM
			, B.SUB_CODE_DESC
			, B.SUB_CODE_NAME
			, B.OPTION_KEY
			, B.USE_YN AS USE_YN
			, B.REG_DATE AS REG_DATE
			, B.REG_ID AS REG_ID
			, B.MOD_DATE AS MOD_DATE
			, B.MOD_ID AS MOD_ID
		FROM CODE_MAIN A LEFT JOIN CODE_SUB B ON A.CODE = B.CODE
		WHERE 1=1
			AND A.USE_YN = 'Y'
			AND A.CODE = #{_parameter}
		ORDER BY A.CODE ASC;
<!-- 			<if test="searchCondition == 1">AND -->
<!-- 					A.CODE LIKE CONCAT('%', #{searchWrd},'%') 		 -->
<!-- 			</if> -->
<!-- 			<if test="searchCondition == 2">AND -->
<!-- 					B.SUB_CODE LIKE CONCAT('%', #{searchWrd},'%') 		 -->
<!-- 			</if> -->
<!-- 			<if test="searchCondition == 3">AND -->
<!-- 					B.SUB_CODE_NAME LIKE CONCAT('%', #{searchWrd},'%') 		 -->
<!-- 			</if> -->					
<!-- 			ORDER BY USER_NM  -->
<!-- 			LIMIT #{recordCountPerPage} OFFSET #{firstIndex} -->
	</select>
	
	<select id="CodeManageDAO.selectCodeList" parameterType="ComDefaultVO" resultType="CodeManageVO">
		SELECT CODE
			, CODE_NAME
			, USE_YN
			,(SELECT COUNT(*) 
			FROM CODE_SUB B 
			WHERE A.CODE = B.CODE) AS COUNT_SUB_CODE
			, REG_DATE
			, REG_ID
			, MOD_DATE
			, MOD_ID
			, CODE_DESC
		FROM CODE_MAIN A
		WHERE 1=1
			AND USE_YN = 'Y'
		ORDER BY CODE ASC
		<!-- 	<if test="searchCondition == 1">AND -->
<!-- 					A.CODE LIKE CONCAT('%', #{searchWrd},'%') 		 -->
<!-- 			</if> -->
<!-- 			<if test="searchCondition == 2">AND -->
<!-- 					B.SUB_CODE LIKE CONCAT('%', #{searchWrd},'%') 		 -->
<!-- 			</if> -->
<!-- 			<if test="searchCondition == 3">AND -->
<!-- 					B.SUB_CODE_NAME LIKE CONCAT('%', #{searchWrd},'%') 		 -->
<!-- 			</if> -->					
<!-- 			ORDER BY USER_NM  -->
<!-- 			LIMIT #{recordCountPerPage} OFFSET #{firstIndex} -->	
	</select>
	
	<insert id="CodeManageDAO.insertCode" parameterType="CodeManageVO">
		INSERT INTO CODE_MAIN
				(
				CODE
				, CODE_NAME
				, USE_YN
				, REG_DATE
				, REG_ID
				, CODE_DESC
				)
		VALUES
				(
				#{code}
				, #{codeName}
				, #{useYn}
				, SYSDATE()
				, 0
				, #{codeDesc}
				)
	</insert>
	
	<update id="CodeManageDAO.updateCode" parameterType="CodeManageVO">
		UPDATE CODE_MAIN
		SET CODE_NAME = #{codeName}
			, USE_YN = #{useYn}
			, MOD_DATE = SYSDATE()
			, MOD_ID = 0
			, CODE_DESC = #{codeDesc}
		WHERE 1=1
		<if test="code != null">
			AND CODE = #{code}
		</if>
	</update>
	
	<update id="CodeManageDAO.deleteCode" parameterType="string">
		UPDATE CODE_MAIN
		SET USE_YN = 'N'
		WHERE CODE = #{_parameter}
	</update>
	
	<select id="CodeManageDAO.selectSubCode" parameterType="string" resultType="SubCodeManageVO">
		SELECT 
			CODE
			, SUB_CODE
			, SORT_NUM  
			, SUB_CODE_DESC
			, SUB_CODE_NAME
			, OPTION_KEY
			, USE_YN
			, REG_DATE
			, REG_ID
			, MOD_DATE
			, MOD_ID
		FROM CODE_SUB
		WHERE 1=1
			AND SUB_CODE = #{_parameter}
	</select>
	
	<insert id="CodeManageDAO.insertSubCode" parameterType="SubCodeManageVO">
		INSERT INTO CODE_SUB
				(
				CODE
				, SUB_CODE
				, SUB_CODE_DESC
				, SUB_CODE_NAME
				, USE_YN
				, REG_DATE
				, REG_ID
				)
		VALUES
				(
				#{code}
				, #{subCode}
				, #{subcodeDesc}
				, #{subCodeName}
				, #{useYn}
				, SYSDATE()
				, 0
				)
	</insert>
	
	<update id="CodeManageDAO.updateSubCode" parameterType="SubCodeManageVO">
		UPDATE CODE_SUB
		SET SUB_CODE_NAME = #{subCodeName}
			, SUB_CODE_DESC = #{subcodeDesc}
			, USE_YN = #{useYn}
			, MOD_DATE = SYSDATE()
			, MOD_ID = 0
		WHERE SUB_CODE = #{subCode}	
	</update>
	
	<update id="CodeManageDAO.deleteSubCode" parameterType="string">
		UPDATE CODE_SUB
		SET USE_YN = 'N'
		WHERE SUB_CODE = #{_parameter}
	</update>
</mapper>