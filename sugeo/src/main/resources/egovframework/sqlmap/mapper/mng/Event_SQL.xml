<?xml version="1.0" encoding="UTF-8"?><!--Converted at: Wed Feb 01 15:11:03 KST 2017-->
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="EventDAO">
	

	<insert id="EventDAO.eventInsert">
		INSERT INTO EVENT_MNG(EVENT_NO, EVENT_TYPE, TITLE,
							  START_DATE, END_DATE,
							  OPEN_YN, REG_DATE, REG_ID, USE_YN, CONTENT, URL)
		VALUES(#{eventNo}, #{eventType}, #{title}, #{startDate}, #{endDate},
			   #{openYn}, now() ,#{regId}, 'Y', #{content}, #{url})
		
	</insert>

	<select id="EventDAO.eventList" resultType="EventVO">
		SELECT EVENT_NO, TITLE, START_DATE,
			   END_DATE, OPEN_YN, REG_DATE, REG_ID, MOD_DATE, MOD_ID,
			   USE_YN, URL, CONTENT, (SELECT SUB_CODE_NAME FROM CODE_SUB WHERE SUB_CODE = EVENT_TYPE) AS EVENT_TYPE
		FROM EVENT_MNG
		WHERE USE_YN = 'Y'
		ORDER BY EVENT_NO DESC
		 LIMIT  #{recordCountPerPage} OFFSET #{firstIndex} 
	</select>
	
	<select id="EventDAO.eventListCnt" resultType="int">
		SELECT count(EVENT_NO)
		FROM EVENT_MNG
		WHERE USE_YN = 'Y'
	</select>
	
	<select id="EventDAO.selectNextEvent_no" resultType="java.lang.Integer">

			SELECT
				ifnull(max(EVENT_NO),0)+1 as EVENT_NO
			FROM
				EVENT_MNG

	</select>
	
	<select id= "EventDAO.selectEvent" resultType="EventVO">
		SELECT *
		FROM EVENT_MNG
		WHERE EVENT_NO = #{eventNo}

	</select>
	
	<select id="EventDAO.subCodeList"  resultType="SubCodeManageVO">
		SELECT *
		FROM CODE_SUB
		WHERE USE_YN = 'Y' AND CODE = 'A0005'
	</select>
	
	<update id="EventDAO.eventDelete" parameterType="Integer">
		UPDATE EVENT_MNG
		SET USE_YN = 'N'
		WHERE EVENT_NO = #{eventNo}
	</update>
	
	<update id="EventDAO.eventUpdate" parameterType="EventVO">
		UPDATE EVENT_MNG
		SET  EVENT_TYPE = #{eventType},
			 TITLE = #{title},
			 START_DATE = #{startDate},
			 END_DATE = #{endDate},
			 OPEN_YN = #{openYn},
			 MOD_DATE = now(),
			 MOD_ID = #{userId}, 
			 URL = #{url},
			 CONTENT = #{content}
			 WHERE EVENT_NO = #{eventNo}
	</update>
	
	<!-- 공지 5개 제한  -->
	<select id="EventDAO.checkYCnt" resultType="int">
		SELECT COUNT(NTT_ID)
		FROM BBS
		WHERE USE_YN = 'Y' AND NOTICE_YN = 'Y'
	</select>
	
	<select id="EventDAO.checkOpenYnCnt" resultType="int">
		SELECT COUNT(EVENT_NO)
		FROM EVENT_MNG
		WHERE OPEN_YN = 'Y'
		AND EVENT_TYPE = #{eventType}
	</select>
	
	<select id="EventDAO.updateRecentEvent" parameterType="EventVO">

		UPDATE EVENT_MNG
		SET OPEN_YN = 'Y'
		WHERE USE_YN = 'Y' 
		<!-- AND EVENT_NO != #{eventNo} -->
		AND START_DATE IN (SELECT * FROM (SELECT MAX(START_DATE)
													FROM EVENT_MNG 
													WHERE EVENT_TYPE =  #{eventType}
													AND USE_YN = 'Y'
													AND EVENT_NO != #{eventNo}) AS A)

	</select>
	
	<update id="EventDAO.eventOpenYnValueSetN">
		UPDATE EVENT_MNG
		SET OPEN_YN = 'N'
		WHERE EVENT_TYPE = #{eventType}
	</update>
	
	<select id="EventDAO.selectEventOne" parameterType="EventVO" resultType="EventVO">
		SELECT EVENT_NO, TITLE, START_DATE,
			   END_DATE, OPEN_YN, REG_DATE, REG_ID, MOD_DATE, MOD_ID,
			   USE_YN, URL, CONTENT, EVENT_TYPE
		FROM EVENT_MNG
		WHERE EVENT_TYPE = #{eventType}
		AND OPEN_YN = 'Y'
		AND USE_YN = 'Y'
	</select>
	
	<!-- <select id="PopManageDAO.selectPopManageListCnt" resultType="int">
		SELECT COUNT(POPUP_ID)
		FROM POPUP_MNG
		WHERE USE_YN = 'Y'
		ORDER BY POPUP_ID DESC
	</select>
	
	<select id="PopManageDAO.selectPopList" resultType="PopManageVO">
		SELECT 
			POPUP_ID
			,POPUP_NAME
			,DATE_FORMAT(START_DT, '%Y-%m-%d %H:%i') as START_DT
			,DATE_FORMAT(END_DT, '%Y-%m-%d %H:%i') as END_DT
			,CONTENT
			,USE_YN
			,URL
			,FILE_ID
		FROM POPUP_MNG
		WHERE USE_YN = 'Y'
        	AND DATE_FORMAT(NOW(), '%Y-%m-%d %H:%i') BETWEEN START_DT AND END_DT
		ORDER BY POPUP_ID DESC
		LIMIT 3
	</select>
	
	<update id="PopManageDAO.updatePopManage" parameterType="PopManageVO">
		UPDATE POPUP_MNG
		SET POPUP_NAME = #{popupName}
			,START_DT = #{startDate}
			,END_DT = #{endDate}
			,CONTENT = #{content}
			,URL = #{url}
			,USE_YN = #{useYn}
		WHERE POPUP_ID = #{popupId}	
	</update>
	
	<delete id="PopManageDAO.deletePopManage" parameterType="string">
		DELETE FROM POPUP_MNG
		WHERE POPUP_ID =  #{value}
	</delete>
	
	<select id="PopManageDAO.selectPopManage" parameterType="string" resultType="PopManageVO">
		SELECT 
			POPUP_ID
			,POPUP_NAME
			,DATE_FORMAT(START_DT, '%Y-%m-%d %H:%i') as START_DT
			,DATE_FORMAT(END_DT, '%Y-%m-%d %H:%i') as END_DT
			,CONTENT
			,USE_YN
			,URL
			,FILE_ID
		FROM POPUP_MNG
		WHERE POPUP_ID = #{value}
	</select> -->
	
</mapper>